{% extends "base.html" %}
{% load static %}

{% block styles %}
    <script>
        function delete_this(){
            fetch("/posts/delete/",{
	            method: "DELETE",
                headers:{'X-CSRFToken':'{{ csrf_token }}','postid':'{{ post.id }}'},
            }
            ).then((response) => {
                if (response.status === 200) {
                    alert('post successfully deleted');
                    window.location.replace("/");
                }else{
                    alert('hmm, something went wrong');
                }
            });
        }

        function create_image(){
            alert('hmm');
            img_element = document.getElementById("post_image");
            source = "data: {{ post.content_type }}," + "{{ post.content|safe }}";
            img_element.src = source;
            alert('should have image');
        }
    </script>
{% endblock %}

{% block content %}
<div>
    <h4 class='fullname'>{{post.author.first_name}} {{post.author.last_name}}</h4>
    <p class='username'>@{{post.author.username}}</p>

</div>
    <h1>{{ post.title }}</h1>
    <p>{{ post.comment }}</p>
    {% if post.content_type == 'text/plain' %}
        <p>{{post.content}}</p>
    {% elif post.content_type == 'text/markdown' %}
        <p>{{post.content}}</p>
    {% else %}
        <img id="post_image" onload="create_image()">
    {% endif %}

    {% if user.username == post.author.username %}
        <a href="javascript:delete_this()">delete</a>
    {% endif %}



    {% for comments in post_comments %}
        {% include "comment.html"%}
    {% endfor %}

<br>
    <div border-style="solid";>

        <form method="post" action="/newComment/" enctype="multipart/form-data">{% csrf_token %}
            <input name="post" type="hidden" value={{ post.id }}>
            <input name="comment" type="text">
            <input type="submit">

        </form>
    </div>
{% endblock%}